It's possible to configure all kinds of things in wiki2book.
This page describes each possible setting and config entry.

See end of document for all existing configuration entries.

# Overview

There are three different places for configurations:
Configuration file, project file and CLI arguments.

They have a large overlap in settings and are evaluated in this order.
This means a settings from the configuration file can be overwritten by the same settings of a project file and such a setting can be overwritten by a CLI argument.

# Configuration file

A configuration file is a JSON file and might look like this:

```json
{
  "cache-dir": "./path/to/cache/",
  "wikipedia-instance": "de",
  "output-type": "epub3",
  "output-driver": "internal"
}
```

Take a look at the `configs/de.json` file for an example file.
The `src/config/config.go` file contains all fields including documentation and default values.
The CLI command `wiki2book --help` will also show information and default values for the general configuration entries.

# Project files

A project file is also a JSON file and can contain all the properties of a configuration file plus some additional entries, which are the following ones:

* A `"metadata": {...}` object containing the following entries:
  * `"title"`: The title of the book.
  * `"language"`: The language of the book.
  * `"author"`: The author of the book.
  * `"license"`: The license of the book, which should be based on the Wikipedia articles licenses.
  * `"date"`: The date of the article.
* The `"output-file"`, which is a path to the output EPUB file.
* The `"articles": [...]` array, which is a list of article names, that should be included into this book.

The following example contains project-specific entries at the top and general config entries at the bottom.

```json
{
  "metadata": {
    "title": "My great book",
    "author": "Wikipedia contributors",
    "license": "Creative Commons Non-Commercial Share Alike 3.0",
    "language": "de-DE",
    "date": "2021-12-27"
  },
  "output-file": "my-book.epub",
  "articles": [
    "Hamburg",
    "Hamburger",
    "Pannfisch"
  ],

  "cache-dir": "./path/to/cache/",
  "output-type": "epub3",
  "output-driver": "internal"
}
```

Take a look at the `projects` folder for further examples.

# Use a different Wikipedia instance

Per default, the english wikipedia (`en`) is used.
However, you can change the `wikipedia-instance` entry in your projects or config file (s. above).
Notice, that you also have to adjust the list of ignore templates and all other language-specific configurations.
Take a look at the [German config file](../configs/de.json) and some [German project files](../projects/de/), to get an idea of a switch to a different Wikipedia instance.

# Configure external tool calls

Call to external tools can be configured using simple command template strings.
Use the `--help` flag to find all command templates, they all start with `command-template-...`.

The [`config.go`](../src/config/config.go) file contains the default values for different commands.

Writing your own command template is simple, here are some examples for your config or project file.

Using inkscape to convert SVGs to PNGs:
```json
"command-template-svg-to-png": "inkscape {INPUT} -o {OUTPUT}",
```

Using a custom script to convert SVGs to PNGs:
```json
"command-template-svg-to-png": "/path/to/your/scripts/svg-to-png.sh -i {INPUT} -o {OUTPUT} --some --other --params",
```

Using the CLI args works in the same way:
`wiki2book --command-template-svg-to-png "inkscape {INPUT} -o {OUTPUT}"`

# List of config entries

See also the [src/config/config.go](../src/config/config.go) file for the actual config code including documentation on each field.
You can also use the `--version` flag to list all options.

| Name                                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Default                                                                                                                                                                                          | Allowed values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `allowed-link-prefixe`              | A list of prefixes that are considered links and are therefore not removed. All prefixes  specified by</br>"FilePrefixe" are considered to be allowed prefixes. Any other not explicitly allowed prefix of a link causes</br>the link to get removed. This especially happens for inter-wiki-links if the Wikipedia instance is not</br>explicitly allowed using this list.                                                                                                                                                                                                                                                               | `[ "arxiv", "doi" ]`                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `cache-dir`                         | The directory where all intermediate files are stored. Relative paths are relative to the config file. The</br>default value is the default cache directory returned by the golang function os.UserCacheDir().</br>JSON example: `"cache-dir": "/path/to/cache"`                                                                                                                                                                                                                                                                                                                                                                          | `"<user-cache-dir>/wiki2book"`                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `cache-eviction-strategy`           | The strategy by which files are removed from the case when it's full.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `"lru"`                                                                                                                                                                                          | Allowed values:<ul><li>`"largest"` - In case the maximum cache size has been reached, the largest file will be removed first.</li><li>`"lru"`     - In case the maximum cache size has been reached, the least recently used file will be removed</br>first. Note that the LRU cache stays in conflict with the CacheMaxAge setting. Using the</br>LRU cache constantly updates timestamps on files, which then might stay longer in cache</br>than CacheMaxAge defines.</li><li>`"none"`    - No cache eviction strategy, i.e. all files are cached and never evicted. Therefore, the</br>CacheMaxSize setting has no effect.</li></ul> |
| `cache-max-age`                     | The maximum age in minutes of files in the cache. All files older than this, will be downloaded/recreated again.</br>Note that setting CacheEvictionStrategy to "lru" stays in conflict with this setting, because the LRU cache</br>constantly updates timestamps on files.                                                                                                                                                                                                                                                                                                                                                              | `40320` (four weeks)                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `cache-max-size`                    | The maximum size of the file cache in bytes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `100000000` (100 MiB)                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `category-prefixes`                 | A list of category prefixes, which are technically internals links. However, categories will be removed from</br>the input wikitext.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `[ "category" ]`                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `command-template-image-processing` | Specifies the template for the command that should be used to process images. This will be called for each</br>downloaded image and can be used to e.g. compress or otherwise process the image. An empty value deactivates</br>the processing and the original image will be used.</br>This template must contain the following placeholders that will be replaced by the actual values before</br>executing the command:<ul><li>`{INPUT}` : The input image file.</li><li>`{OUTPUT}` : The output image file.</li></ul>JSON example: `"command-template-image-processing": "my-command --some-arg -i {INPUT} -o {OUTPUT}"`              | `"magick {INPUT} -resize 600x600> -quality 75 -define PNG:compression-level=9 -define PNG:compression-filter=0 -colorspace gray {OUTPUT}"`                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `command-template-math-svg-to-png`  | Specifies the template for the command that should be used to convert the SVG files of math expressions into</br>PNGs. This template is only used when setting MathConverter to "template". This command might use additional</br>parameters in comparison to the normal SVG to PNG command template.</br>This template must contain the following placeholders that will be replaced by the actual values before</br>executing the command:<ul><li>`{INPUT}` : The input SVG file.</li><li>`{OUTPUT}` : The output PNG file.</li></ul>JSON example: `"command-template-math-svg-to-png": "my-command --some-arg -i {INPUT} -o {OUTPUT}"` | Default:<ul><li>When the specified CSS file exists: `"rsvg-convert -s /usr/share/wiki2book/rsvg-math.css -o {OUTPUT} {INPUT}"`</li><li>Otherwise: `"rsvg-convert -o {OUTPUT} {INPUT}"`</li></ul> |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `command-template-pdf-to-png`       | Specifies the template for the command that should be used to convert PDF into PNG files. An empty value</br>deactivates the processing and the original image will be used.</br>This template must contain the following placeholders that will be replaced by the actual values before</br>executing the command:<ul><li>`{INPUT}` : The input PDF file.</li><li>`{OUTPUT}` : The output PNG file.</li></ul>JSON example: `"command-template-pdf-to-png": "my-command --some-arg -i {INPUT} -o {OUTPUT}"`                                                                                                                               | `"magick -density 300 {INPUT} {OUTPUT}"`                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `command-template-svg-to-png`       | Specifies the template for the command that should be used to convert the SVG files into PNGs. This command</br>might use additional parameters in comparison to the normal SVG to PNG command template. An empty value</br>deactivates the processing and the original image will be used.</br>This template must contain the following placeholders that will be replaced by the actual values before</br>executing the command:<ul><li>`{INPUT}` : The input SVG file.</li><li>`{OUTPUT}` : The output PNG file.</li></ul>JSON example: `"command-template-svg-to-png": "my-command --some-arg -i {INPUT} -o {OUTPUT}"`                | `"rsvg-convert -o {OUTPUT} {INPUT}"`                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `command-template-webp-to-png`      | Specifies the template for the command that should be used to convert WebP into PNG files. An empty value</br>deactivates the processing and the original image will be used.</br>This template must contain the following placeholders that will be replaced by the actual values before</br>executing the command:<ul><li>`{INPUT}` : The input WebP file.</li><li>`{OUTPUT}` : The output PNG file.</li></ul>JSON example: `"command-template-webp-to-png": "my-command --some-arg -i {INPUT} -o {OUTPUT}"`                                                                                                                            | `"magick {INPUT} {OUTPUT}"`                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `cover-image`                       | The image file that should be the cover of the eBook. Relative paths are relative to the config file.</br>JSON example: `"cover-image": "nice-picture.jpeg"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `file-prefixe`                      | A list of prefixes to detect files, e.g. in "File:picture.jpg" the substring "File" is the image prefix. The list</br>must be in lower case.</br>JSON example: `"file-prefixe": [ "file", "datei" ]`                                                                                                                                                                                                                                                                                                                                                                                                                                      | `[ "file", "image", "media" ]`                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `font-files`                        | A list of font files that should be used. They then can be referenced from the style CSS file. Relative paths are relative to the config file.</br>JSON example: `"font-files": ["./fontA.ttf", "/path/to/fontB.ttf"]`                                                                                                                                                                                                                                                                                                                                                                                                                    | `[]`                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `force-regenerate-html`             | Forces wiki2book to recreate HTML files even if they exists from a previous run.</br>JSON example: `"force-regenerate-html": true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `false`                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `ignored-image-params`              | Parameters of images that should be ignored. The list must be in lower case.</br>JSON example: `"ignored-image-params": [ "alt", "center" ]`</br>This ignores the image parameters "alt" and "center" including any parameter values like "alt"="some alt text".                                                                                                                                                                                                                                                                                                                                                                          | `[]`                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `ignored-media-types`               | List of media types to ignore, i.e. list of file extensions. Some media types (e.g. videos) are not of much use</br>for a book.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `[ "gif", "mp3", "mp4", "pdf", "oga", "ogg", "ogv", "wav", "webm" ]`                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `ignored-templates`                 | List of templates that should be ignored and removed from the input wikitext. The list must be in lower case.</br>JSON example: `"ignored-templates": [ "foo", "bar" ]`</br>This ignores `{{foo}}` and `{{bar}}` occurrences in the input text.                                                                                                                                                                                                                                                                                                                                                                                           | `[]`                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `math-converter`                    | Sets the converter to turn math SVGs into PNGs. This can be one of the following values:<ul><li>"none": Uses no converter, instead the plain SVG file is inserted into the ebook.</li><li>"wikimedia": Uses the online API of Wikimedia to get the PNG version of a math expression.</li><li>"template": Uses the CommandTemplateMathSvgToPng to convert math SVG files to PNGs.</li></ul>                                                                                                                                                                                                                                                | `[ "wikimedia" ]`                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `output-driver`                     | The way the final output is created.</br>JSON example: `"output-driver": "pandoc"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `pandoc`                                                                                                                                                                                         | `pandoc`, `internal`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `output-type`                       | The type of the final result.</br>JSON example: `"output-type": "epub2"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `epub2`                                                                                                                                                                                          | `epub2`, `epub3`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `pandoc-data-dir`                   | The data directory for pandoc. Relative paths are relative to the config file.</br>JSON example: `"pandoc-data-dir": "./my-folder/"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `""`                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `pandoc-executable`                 | The executable name or file for pandoc.</br>JSON example: `"pandoc-executable": "/path/to/pandoc"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `"pandoc"`                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `style-file`                        | The CSS style file that should be embedded into the eBook. Relative paths are relative to the config file.</br>JSON example: `"style-file": "my-style.css"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `"/use/share/wiki2book/style.css"` on Linux when it exists; `""` otherwise                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `svg-size-to-viewbox`               | Sets the 'width' and 'height' property of an SimpleSvgAttributes image to its viewbox width and height. This might fix wrong SVG sizes on some eBook-readers.</br>JSON example: `"svg-size-to-viewbox": true`                                                                                                                                                                                                                                                                                                                                                                                                                             | `false`                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `toc-depth`                         | Sets the depth of the table of content, i.e. how many sub-headings should be visible.</br>Examples:<ul><li>A value of 1 means only the h1 headings are visible in the table of content.</li><li>A value of 3 means h1, h2 and h3 are visible.</li><li>A value of 0 means the table of content is not visible at all.</li></ul>                                                                                                                                                                                                                                                                                                            | `2`                                                                                                                                                                                              | `0` to `6`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `trailing-templates`                | List of templates that will be moved to the end of the document. Theses are e.g. remarks on the article that</br>are important but should be shown as a remark after the actual content of the article.</br>JSON example: `"trailing-templates": [ "foo", "bar" ]`</br>This moves `{{foo}}` and `{{bar}}` to the end of the document.                                                                                                                                                                                                                                                                                                     | `[]`                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `user-agent-template`               | Template string for the user agent used in HTTP requests. There are some placeholders within this template</br>string, which are replaced by actual values:<ul><li>`{{VERSION}}` - The version of wiki2book as shown by the `--version` CLI argument. Example: `v0.4.0`</li></ul>                                                                                                                                                                                                                                                                                                                                                         | `"wiki2book {{VERSION}} (https://github.com/hauke96/wiki2book)"`                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `wikipedia-host`                    | The domain of the Wikipedia instance.</br>JSON example: `"wikipedia-host": "my-server.com"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `"wikipedia.org"`                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `wikipedia-image-article-hosts`     | Domains used to search for image articles (not the image files themselves, s. WikipediaImageHost). The given</br>values are tried in the configured order until a request was successful or the last host has been tried.</br>JSON example: `"wikipedia-image-article-hosts": [ "commons.wikimedia.org" ]`                                                                                                                                                                                                                                                                                                                                | `[ "commons.wikimedia.org", "en.wikipedia.org" ]`                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `wikipedia-image-host`              | The domain of the Wikipedia image instance, which should be used to download the actual image files.</br>JSON example: `"wikipedia-image-host": "my-image-server.com"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `"upload.wikimedia.org"`                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `wikipedia-instance`                | The subdomain of the Wikipedia instance.</br>JSON example: `"wikipedia-instance": "de"` This config would then use the German Wikipedia.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `"en"`                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `wikipedia-math-rest-api`           | The URL to the math API of wikipedia. This API provides rendering functionality to turn math-objects into PNGs or SVGs.</br>JSON example: `"wikipedia-math-rest-api": "my-math-server.com/api"`                                                                                                                                                                                                                                                                                                                                                                                                                                           | `"https://wikimedia.org/api/rest_v1/media/math"`                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `worker-threads`                    | Number of threads to process the articles. Only affects projects but not single articles or the standalone mode.</br>A higher number of threads might increase performance, but it also puts more stress on the Wikipedia API, which</br>might lead to "too many requests"-errors. These errors are handled by wiki2book, but a high thread count might</br>still negatively affect wiki2book. Use a value of 1 to disable parallel processing.                                                                                                                                                                                           | `5`                                                                                                                                                                                              | `1` to unlimited                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
